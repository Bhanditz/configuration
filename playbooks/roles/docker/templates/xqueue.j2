#!/bin/sh
set -e

{% if COMMON_ENABLE_NEWRELIC_APP %}
NEW_RELIC_APP_NAME={{ XQUEUE_NEWRELIC_APPNAME }}
NEW_RELIC_LICENSE_KEY={{ NEWRELIC_LICENSE_KEY }}
{% endif -%}
PID=/var/tmp/xqueue.pid
PORT={{ xqueue_gunicorn_port }}
ADDRESS={{ xqueue_gunicorn_host }}
LANG={{ XQUEUE_LANG }}
DJANGO_SETTINGS_MODULE=xqueue.aws_settings
SERVICE_VARIANT="xqueue"

{% if COMMON_ENABLE_NEWRELIC_APP %}
{% set executable = xqueue_venv_bin + '/newrelic-admin run-program ' + xqueue_venv_bin + '/gunicorn' %}
{% else %}
{% set executable = xqueue_venv_bin + '/gunicorn' %}
{% endif %}
exec /sbin/setuser {{ common_web_user }} {{ executable }} -c {{ xqueue_app_dir }}/xqueue_gunicorn.py {{ XQUEUE_GUNICORN_WORKERS_EXTRA }} xqueue.wsgi
