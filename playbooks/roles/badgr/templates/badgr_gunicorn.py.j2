"""
gunicorn configuration file: http://docs.gunicorn.org/en/develop/configure.html

{{ ansible_managed }}
"""
import multiprocessing

preload_app = True
timeout = 300
bind = "{{ badgr_gunicorn_host }}:{{ badgr_gunicorn_port }}"
pythonpath = "{{ badgr_code_dir }}"

{% if BADGR_MAX_REQ -%}
max_requests = {{ BADGR_MAX_REQ }}
{% endif -%}

workers = (multiprocessing.cpu_count()-1) + 1

{{ common_close_all_caches }}

def post_fork(server, worker):
    close_all_caches()

{{ BADGR_GUNICORN_EXTRA_CONF }}
