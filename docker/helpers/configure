#!/bin/sh
set -e

# Run RabbitMQ configuration
cd /configuration/playbooks && \
    ansible-playbook run_role.yml -i localhost, -c local \
        -e role=rabbitmq_configure \
        -e rabbitmq_ip=127.0.0.1

# Remove stale forum socket if it exists
rm /edx/var/forum/forum.sock || true
/edx/bin/supervisorctl restart forum

sleep infinity  # Sleep forever so runit doesn't restart this script
